<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>自定义词库管理</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f0518;
      --panel: rgba(17, 24, 39, 0.6);
      --card: rgba(11, 18, 32, 0.5);
      --text: #f1f5f9;
      --muted: #94a3b8;
      --accent: #8b5cf6;
      --accent-2: #06b6d4;
      --border: rgba(255, 255, 255, 0.08);
      --radius: 20px;
      --shadow-color: rgba(0, 0, 0, 0.4);
      --font-sans: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      --font-display: "Outfit", "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0;
      min-height: 100vh;
      background-color: var(--bg);
      background-image:
        radial-gradient(900px 700px at 12% 10%, rgba(124, 58, 237, 0.18), transparent 55%),
        radial-gradient(900px 700px at 88% 12%, rgba(34, 211, 238, 0.16), transparent 55%),
        radial-gradient(900px 700px at 88% 92%, rgba(124, 58, 237, 0.14), transparent 55%),
        radial-gradient(900px 700px at 10% 90%, rgba(34, 211, 238, 0.12), transparent 55%);
      color: var(--text);
      font-family: var(--font-sans);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 16px 64px;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -2;
      opacity: 0.9;
      background-image:
        repeating-linear-gradient(to right, rgba(255, 255, 255, 0.055) 0px, rgba(255, 255, 255, 0.055) 1px, transparent 1px, transparent 44px),
        repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.045) 0px, rgba(255, 255, 255, 0.045) 1px, transparent 1px, transparent 44px),
        repeating-linear-gradient(to right, rgba(124, 58, 237, 0.09) 0px, rgba(124, 58, 237, 0.09) 1px, transparent 1px, transparent 220px),
        repeating-linear-gradient(to bottom, rgba(34, 211, 238, 0.075) 0px, rgba(34, 211, 238, 0.075) 1px, transparent 1px, transparent 220px);
      mask-image: radial-gradient(75% 60% at 50% 25%, #000 60%, transparent 100%);
      -webkit-mask-image: radial-gradient(75% 60% at 50% 25%, #000 60%, transparent 100%);
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -2;
      background:
        radial-gradient(1200px 800px at 50% 20%, rgba(255, 255, 255, 0.06), transparent 60%),
        radial-gradient(900px 700px at 50% 100%, rgba(0, 0, 0, 0.55), transparent 55%),
        linear-gradient(to bottom, rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.65));
      mix-blend-mode: soft-light;
      opacity: 0.7;
    }

    .shell {
      width: min(800px, 100%);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.055), rgba(255, 255, 255, 0.02));
      backdrop-filter: blur(26px) saturate(1.2);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid var(--border);
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: var(--radius);
      box-shadow:
        0 30px 90px -18px rgba(0, 0, 0, 0.6),
        0 8px 26px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      padding: 28px 28px 20px;
      position: relative;
      z-index: 1;
    }

    .shell::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(700px 400px at 20% 15%, rgba(34, 211, 238, 0.12), transparent 60%),
        radial-gradient(700px 400px at 80% 0%, rgba(124, 58, 237, 0.14), transparent 60%);
      opacity: 0.9;
    }

    h1 { margin: 0 0 6px; font-size: 26px; font-family: var(--font-display); font-weight: 800; }
    p.subtitle { margin: 0 0 18px; color: var(--muted); font-size: 14px; }

    textarea {
      width: 100%;
      background: rgba(20, 25, 40, 0.8) !important;
      border: 2px solid #22d3ee !important;
      border-radius: 14px;
      padding: 14px;
      color: #ffffff !important;
      caret-color: #22d3ee;
      font-size: 15px;
      min-height: 180px;
      resize: vertical;
      outline: none;
      box-shadow:
        0 0 0 3px rgba(34, 211, 238, 0.3),
        0 10px 28px rgba(0, 0, 0, 0.55);
      transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      position: relative !important;
      z-index: 10 !important;
      opacity: 1 !important;
      visibility: visible !important;
      display: block !important;
      margin-bottom: 40px !important;
    }

    textarea:focus {
      border-color: #38bdf8;
      box-shadow:
        0 0 0 2px rgba(34, 211, 238, 0.4),
        0 12px 32px rgba(0, 0, 0, 0.6);
      background: rgba(255, 255, 255, 0.1);
    }

    textarea::placeholder {
      color: rgba(255, 255, 255, 0.9);
    }

    .controls { display: flex; gap: 10px; flex-wrap: wrap; margin: 14px 0; }

    .btn {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.95), rgba(6, 182, 212, 0.9));
      border: 1px solid rgba(255, 255, 255, 0.10);
      color: white;
      padding: 11px 16px;
      border-radius: 12px;
      font-weight: 750;
      font-family: var(--font-display);
      letter-spacing: 0.2px;
      cursor: pointer;
      /* 移除 transform transition，避免与 GSAP 冲突 */
      transition: box-shadow 0.3s ease, background 0.3s ease, border-color 0.3s ease, transform 0.1s ease;
      box-shadow:
        0 16px 34px rgba(124, 58, 237, 0.22),
        0 10px 22px rgba(6, 182, 212, 0.12),
        0 1px 0 rgba(255, 255, 255, 0.14) inset;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
    }

    .btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(600px 120px at 10% 0%, rgba(255, 255, 255, 0.22), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .btn:active {
      transform: scale(0.96);
    }

    /* 移除 CSS hover transform，完全交给 GSAP */
    .btn:hover {
      border-color: rgba(255, 255, 255, 0.16);
      box-shadow:
        0 20px 44px rgba(124, 58, 237, 0.26),
        0 14px 32px rgba(6, 182, 212, 0.18),
        0 1px 0 rgba(255, 255, 255, 0.16) inset;
    }

    /* 布局平滑过渡 */
    .shell, textarea, .list, .export-box, .footer {
      transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* 背景色块，避免遮挡主体 */
    .bg-blob {
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      z-index: 0;
      opacity: 0.6;
      pointer-events: none;
    }
    .blob-1 { top: -15%; left: -20%; width: 50vw; height: 50vw; background: var(--accent); opacity: 0.18; }
    .blob-2 { bottom: -10%; right: -15%; width: 40vw; height: 40vw; background: var(--accent-2); opacity: 0.18; }
    .blob-3 { top: 40%; left: 30%; width: 30vw; height: 30vw; background: #3b82f6; opacity: 0.12; }

    .btn.ghost {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
      box-shadow: none;
    }

    .btn.ghost::before { display: none; }

    .btn.ghost:hover { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.2); }

    @media (prefers-reduced-motion: reduce) {
      .shell, textarea, .list, .export-box, .footer {
        transition: none !important;
      }
      .btn {
        transition: none !important;
      }
    }

    .hint { color: var(--muted); font-size: 12px; margin-top: 4px; }
    .list { margin-top: 12px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px; min-height: 80px; }
    .pill { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; background: rgba(34, 211, 238, 0.12); color: #a5f3fc; border: 1px solid rgba(34, 211, 238, 0.35); margin: 4px; font-size: 13px; }
    .footer { color: var(--muted); font-size: 12px; margin-top: 12px; }
    .export-box { margin-top: 10px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 10px; font-size: 12px; color: var(--muted); word-break: break-all; }
  </style>
</head>
<body>
  <div class="bg-blob blob-1"></div>
  <div class="bg-blob blob-2"></div>
  <div class="bg-blob blob-3"></div>

  <div class="shell">
    <h1>自定义词库</h1>
    <p class="subtitle">填入要参与押韵的自定义词或单字，空格/逗号/换行分隔。会保存在浏览器本地并被主页自动加载。</p>

    <textarea id="input" placeholder="示例：北京 程序员 飞"></textarea>
    <div class="hint">添加规则：多字词会被拆成单字参与押韵；保存后数据存入 localStorage（不会上传）。</div>

    <div class="controls">
      <button class="btn" id="save" type="button" onclick="handleSave()">保存到浏览器</button>
      <button class="btn ghost" id="clear" type="button" onclick="handleClear()">清空自定义</button>
      <button class="btn ghost" id="back" type="button" onclick="location.href='index.html'">返回生成器</button>
      <button class="btn ghost" id="export" type="button" onclick="handleExport()">导出到剪切板</button>
      <button class="btn ghost" id="import" type="button" onclick="handleImport()">从剪切板导入</button>
    </div>

    <div class="list" id="current"></div>
    <div class="export-box" id="exportBox" style="display:none;"></div>
    <div class="hint" id="status"></div>

    <div class="footer">存储键：CUSTOM_RHYME_BANK。主页会读取并合并至字库。</div>
  </div>

  <script>
    const STORAGE_KEY = 'CUSTOM_RHYME_BANK';
    let memoryStore = [];

    const status = (msg) => {
      document.getElementById('status').textContent = msg;
      console.log('[custom]', msg);
    };

    const storageAvailable = () => {
      try {
        const t = '__TEST__';
        localStorage.setItem(t, '1');
        localStorage.removeItem(t);
        return true;
      } catch (e) {
        return false;
      }
    };

    const parseInput = (text) => {
      return text
        .replace(/[，,；;、\n\r\t]+/g, ' ')
        .split(' ')
        .map((s) => s.trim())
        .filter(Boolean);
    };

    const loadList = () => {
      if (!storageAvailable()) return [...memoryStore];
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        if (!Array.isArray(arr)) return [];
        // 过滤掉无效词条（旧版本可能误存入的代码片段）
        const invalidPatterns = /^(\/\/|const|customBank|data\.js|追加到|中的|\[|\]|\{|\}|=|;|'|"|`)/;
        return arr.filter(w => {
          if (!w || typeof w !== 'string') return false;
          const trimmed = w.trim();
          if (!trimmed) return false;
          if (invalidPatterns.test(trimmed)) return false;
          return true;
        });
      } catch (e) {
        status('读取 localStorage 失败，改用内存存储。');
        return [...memoryStore];
      }
    };

    const saveList = (list) => {
      const uniq = Array.from(new Set(list));
      if (!storageAvailable()) {
        memoryStore = uniq;
        status('当前环境不可写入 localStorage，已暂存于内存（刷新后会丢失）');
        return uniq;
      }
      localStorage.setItem(STORAGE_KEY, JSON.stringify(uniq));
      status('已写入 localStorage');
      return uniq;
    };

    const renderList = () => {
      const box = document.getElementById('current');
      const list = loadList();
      if (!list.length) {
        box.textContent = '当前无自定义词';
        return;
      }
      box.innerHTML = '';
      list.forEach((w) => {
        const span = document.createElement('span');
        span.className = 'pill';
        span.textContent = w;
        box.appendChild(span);
      });
    };

    function handleSave() {
      console.log('保存按钮被点击');
      const text = document.getElementById('input').value;
      const parts = parseInput(text);
      if (!parts.length) {
        showToast('请输入至少一个词/字');
        return;
      }
      saveList(parts.concat(loadList()));
      document.getElementById('input').value = '';
      renderList();
      alert('已保存 ' + parts.length + ' 个词到浏览器');
    }

    function handleClear() {
      const list = loadList();
      if (!list.length) {
        alert('当前无自定义词');
        return;
      }
      if (!confirm('确认清空自定义词库？')) return;
      if (storageAvailable()) localStorage.removeItem(STORAGE_KEY);
      memoryStore = [];
      renderList();
      status('已清空');
    }

    function handleExport() {
      const list = loadList();
      const box = document.getElementById('exportBox');
      if (!list.length) {
        box.style.display = 'block';
        box.textContent = '当前无自定义词可导出。';
        alert('当前无自定义词可导出');
        return;
      }
      // 用换行分隔导出
      const exportText = list.join('\n');
      navigator.clipboard.writeText(exportText).then(() => {
        box.style.display = 'block';
        box.textContent = '已复制到剪切板：' + list.join('、');
        alert('已导出 ' + list.length + ' 个词到剪切板');
      });
    }

    function handleImport() {
      const inputBox = document.getElementById('input');
      navigator.clipboard.readText().then(clipText => {
        if (clipText && clipText.trim()) {
          inputBox.value = clipText;
          inputBox.focus();
          alert('已粘贴到输入框，点击"保存到浏览器"确认');
        } else {
          alert('剪切板为空');
        }
      });
    }

    const init = () => {
      try {
        console.log('开始初始化');
        renderList();
        status(storageAvailable() ? 'localStorage 可用，数据会持久保存于浏览器' : 'localStorage 不可用，将使用内存存储，刷新后会丢失');
        console.log('初始化完成');
      } catch (e) {
        alert('初始化失败，请查看控制台');
        console.error('初始化错误:', e);
      }
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
  <script src="data.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script>
    // GSAP Animations
    document.addEventListener("DOMContentLoaded", () => {
      gsap.config({ nullTargetWarn: false });

      // 1. Background Blobs Floating
      gsap.to(".blob-1", {
        x: "20%", y: "20%", duration: 8, repeat: -1, yoyo: true, ease: "sine.inOut"
      });
      gsap.to(".blob-2", {
        x: "-20%", y: "-20%", duration: 10, repeat: -1, yoyo: true, ease: "sine.inOut", delay: 1
      });
      gsap.to(".blob-3", {
        x: "15%", y: "-15%", scale: 1.2, duration: 12, repeat: -1, yoyo: true, ease: "sine.inOut", delay: 2
      });

      // 2. Entry Animations
      const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

      tl.from(".shell", {
        y: 30,
        opacity: 0,
        duration: 1.2,
        clearProps: "all"
      })
      .from("h1", {
        y: 20,
        opacity: 0,
        duration: 0.8
      }, "-=0.8")
      .from(".subtitle", {
        y: 10,
        opacity: 0,
        duration: 0.8
      }, "-=0.6")
      .from("textarea", {
        y: 20,
        opacity: 0,
        duration: 0.8
      }, "-=0.6")
      .from(".btn", {
        y: 20,
        opacity: 0,
        duration: 0.6,
        stagger: 0.1
      }, "-=0.6")
      .from(".list", { // Fixed selector from #list to .list
        opacity: 0,
        y: 20,
        duration: 0.8
      }, "-=0.4");

      // 3. Interactive Elements
      const buttons = document.querySelectorAll(".btn");
      buttons.forEach(btn => {
        btn.addEventListener("mouseenter", () => {
          gsap.to(btn, { scale: 1.05, duration: 0.3, ease: "back.out(1.7)" });
        });
        btn.addEventListener("mouseleave", () => {
          gsap.to(btn, { scale: 1, duration: 0.3, ease: "power2.out" });
        });
        btn.addEventListener("mousedown", () => {
          gsap.to(btn, { scale: 0.92, duration: 0.1, ease: "power1.out" });
        });
        btn.addEventListener("mouseup", () => {
          gsap.to(btn, { scale: 1.05, duration: 0.4, ease: "elastic.out(1, 0.3)" });
        });
      });
    });
  </script>
</body>
</html>
