# FakerRhymes

无情押韵机器人

## 🚀 v1.5.2 更新

- **韵脚精细化分离**：将“人辰辙”拆分为“人辰辙-深”(en, un) 与 “人辰辙-亲”(in, vn, ün)，修正了 `en` 和 `in` 不通的问题。
- **优化宽松匹配算法**：
  - `en/un` 字组优先匹配 `eng/ong` (前后鼻音合并)。
  - `in/vn` 字组优先匹配 `ing`。
- **听感优化**：增加了声母类型过滤，避免平翘舌音带来的听感突变。

---

### 1. 韵母提取与隔离 (Triple-I Isolation)

- **标准处理**：自动处理 `ü` 为 `v`，兼容 `j/q/x/y` 后的拼音转换。
- **i 韵隔离**：针对拼音 `i` 做了三级隔离，避免听感差异过大：
  - `i-flat` (平舌音)：z, c, s 后的 i。
  - `i-retro` (翘舌音)：zh, ch, sh, r 后的 i。
  - `i` (标准音)：其他声母（如 b, p, m, d, t, n, l, j, q, x, y）后的 i。

### 2. 十四辙体系 (基于传统十三辙改进)

程序将中文韵脚划分为 14 个基本辙口，包括：

- **人辰辙-深 (en, un)**：与 **中东辙 (eng)** 在宽松模式下合并。
- **人辰辙-亲 (in, vn, ün)**：与 **中东辙 (ing)** 在宽松模式下合并。
- _这种拆分修正了传统人辰辙中 "en" 和 "in" 不通的问题。_

### 3. 三档匹配机制 (Looseness Tiers)

- **严格 (Tier 0)**：同韵同调，必须完全匹配基本韵母和声调。
- **中等 (Tier 1)**：同调匹配，允许前/后鼻音合并（如 an/ang 合并），但仍区分声调。
- **最松 (Tier 2)**：无视声调，且进一步放宽同辙口内的所有韵母。

### 4. 听感过滤 (Sound Filtering)

- **声母类型过滤**：如果源字不是平翘舌音（zh/ch/sh/r/z/c/s），则匹配结果中也会排除平翘舌音。这避免了“自律(l)”匹配到“世世(sh)”这种发音方式差异显著、听感较差的情况。
- **末尾对齐算法**：无论生成的词语长短，均优先保证末尾韵脚的对齐。

### 5. 多级词库查询

1. **精确词组查询**：优先从 `dict_optimized.json` 查询整句/整词。
2. **随机逐字生成**：若词库无结果，则基于单字库进行随机构造。
3. **降级搜索**：若长词无匹配，会自动缩短长度尝试搜索部分匹配结果。

### 首次加载词库

1. 点击 "📚 加载词库" 按钮
2. 查看进度条和百分比
3. 完成后显示 "✓ 已加载 XXXX 字"
4. 词库缓存在 `localStorage`，下次打开无需重新加载

### 浏览器兼容性

- ✅ Chrome/Edge 95+
- ✅ Firefox 79+
- ✅ Safari 14.1+
- ✅ 无 Web Worker 支持的老浏览器 - 自动回退

已实施的优化包括：

### 1. Web Worker 后台处理

- ✅ 已创建 `dict-worker.js` - 在独立线程中加载和解析词库
- ✅ 主线程保持响应，用户界面流畅
- ✅ 支持实时进度报告

### 2. 流式下载和分块处理

- ✅ 使用 `ReadableStream` 处理大文件
- ✅ 每 1000 项报告一次进度，实时显示加载百分比
- ✅ 添加进度条和文本提示

### 3. 支持回退方案

- ✅ 如果浏览器不支持 Web Worker，自动降级到改进的同步模式
- ✅ 回退模式中每 5000 项更新一次进度，不完全卡死

### 4. 详细统计显示

- ✅ 加载完成后显示详细的统计信息
- ✅ 支持在浏览器控制台查看完整数据

### `dict-worker.js` 工作流程

```
主线程 → 发送加载请求 → Worker 线程
                    ↓
                 下载文件 (流式)
                    ↓
                 JSON.parse()
                    ↓
                 提取汉字 (定期报告进度)
                    ↓
主线程 ← 接收字数组 ← 完成
 ↓
更新 UI 和 localStorage
```

---

## 🛠️ 核心押韵逻辑

本程序不仅是简单的韵母匹配，内部实现了一套针对现代中文（尤其是舞台表演/Rap）优化的押韵引擎：
