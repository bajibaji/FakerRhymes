<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>废壳韵脚生成器 v1.7.5</title>
	<link rel="preconnect" href="https://unpkg.com" />
	<link rel="preconnect" href="https://cdnjs.cloudflare.com" />
	<link rel="preconnect" href="https://cdn.jsdelivr.net" />
	
	<!-- Preload Critical Resources -->
	<link rel="preload" href="styles/main.css" as="style" />
	<link rel="preload" href="scripts/app.js" as="script" />
	<link rel="preload" href="scripts/rhyme-engine.js" as="script" />
	<link rel="preload" href="scripts/dict-manager.js" as="script" />
	<link rel="preload" href="https://cdn.jsdelivr.net/npm/pinyin-pro@3.27.0/dist/index.js" as="script" />

	<link href="remixicon/remixicon.css" rel="stylesheet" />
	<link rel="stylesheet" href="styles/main.css">
</head>
<body>
	<div class="bg-blob blob-1"></div>
	<div class="bg-blob blob-2"></div>
	<div class="bg-blob blob-3"></div>

	<div class="shell">
		<header>
			<h1>废壳韵脚生成器 v1.7.5</h1>
			<p class="credit">©TRUEPEAK 2026 - DEVELOPED BY DANJUAN </p>
			<p class="subtitle">输入词语，自动提取拼音、声调与韵母，生成每个字同声调同韵母的押韵字串。</p>
		</header>

		<main>
			<section class="panel">
				<div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; font-weight: 600; margin-bottom: 10px;">
					<label for="source">请输入要押韵的词语：</label>
					<a class="btn ghost small" href="custom.html"><i class="ri-file-list-3-line"></i>自定义词库</a>
				</div>
				<textarea id="source" placeholder="示例：废壳"></textarea>

				<div class="controls" style="display: flex; flex-direction: column; gap: 1px; margin-top: 12px; width: 100%;">
					<div style="display: flex; gap: 10px; flex-wrap: wrap;">
						<button class="btn" id="go">生成押韵</button>
						<button class="btn ghost small" id="loadDictBtn" title="从在线词库加载更多汉字">📚 加载词库</button>
					</div>
					<label class="small" style="margin-top: 10px;">韵脚宽松度</label>
					<div class="looseness-buttons" id="loosenessButtons" style="width: 100%;">
						<button class="looseness-btn active" data-value="0.0">严格</button>
						<button class="looseness-btn" data-value="0.5">中等</button>
						<button class="looseness-btn" data-value="1.0">最松</button>
					</div>
					<input type="hidden" id="looseness" value="0.0" />
					
					<div id="pingzeFilterContainer" style="margin-top: 10px; padding: 10px; background: rgba(124, 58, 237, 0.08); border-radius: 8px; border: 1px solid var(--border); width: 100%;">
						<label class="small" style="margin-bottom: 8px; display: block; text-align: center;">平仄过滤（尾字声调）</label>
						<div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
							<label style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 13px; margin: 0;">
								<input type="radio" name="pingze" value="all" checked /> <span>全部</span>
							</label>
							<label style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 13px; margin: 0;">
								<input type="radio" name="pingze" value="ping" /> <span>平</span>
							</label>
							<label style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 13px; margin: 0;">
								<input type="radio" name="pingze" value="ze" /> <span>仄</span>
							</label>
						</div>
					</div>
				</div>

				<div class="controls" style="display: flex; flex-direction: column; gap: 10px; margin-top: 16px; border-top: 1px solid var(--border); padding-top: 16px;">
					<div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
						<div style="display: flex; align-items: center; gap: 8px;">
							<input type="checkbox" id="aiMode" style="width: 18px; height: 18px; cursor: pointer;" />
							<label class="small" style="margin-bottom: 0; cursor: pointer;" for="aiMode"><i class="ri-robot-2-line"></i> AI 押韵模式 (Gemini API)</label>
						</div>
						<button class="btn ghost small" id="openAiSettings" title="AI 设置"><i class="ri-settings-3-line"></i></button>
					</div>
				</div>

				<div style="color:brown; font-size: small; font-weight: bold; text-align: center; margin-top: 12px;" id="dictWarning">*第一次使用前请先加载词库*</div>
				<div class="hint">- 严格：同韵同调  | 中等：韵母放宽 | 最松：忽略声调。</div>
				<div class="hint">- 生成结果的词是乱码的话，说明没有结果，调节韵脚宽松度即可。</div>
			</section>

			<section class="panel">
				<div style="font-weight: 600; margin-bottom: 14px;">生成结果</div>
				<div class="output" id="output"></div>
				<div class="badge-row" id="badges"></div>
			</section>
		</main>

		<section class="panel" style="margin: 0 32px 20px;">
			<label style="margin-bottom: 14px;">音调选择</label>
			<table>
				<thead>
					<tr>
						<th>原字</th>
						<th>拼音</th>
						<th>声调</th>
						<th>韵母/控制</th>
					</tr>
				</thead>
				<tbody id="detailBody"></tbody>
			</table>
		</section>

		<section class="panel" style="margin: 0 32px 20px;">
			<div id="matchedResults" style="padding: 12px; background: rgba(34, 211, 238, 0.05); border: 1px solid var(--border); border-radius: 8px; display: none;">
				<div style="font-weight: 600; margin-bottom: 8px; color: var(--accent-2);">更多匹配结果：</div>
				<div id="matchedResultsList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
			</div>
			<div id="dictStatus" style="margin-top: 12px; padding: 8px 12px; background: rgba(124, 58, 237, 0.08); border-radius: 8px; font-size: 12px; color: var(--muted); display: none;">
				<span id="dictStatusText"></span>
			</div>
		</section>

		<div class="footer">词库基于雾凇拼音词库以及中华新华字典数据库以及清华大学开放中文词库，查询算法基于 pinyin-pro 解析。点击"📚 加载词库"可从在线词典获取7000+汉字，数据缓存在本地，可离线使用。</div>
	</div>

	<!-- AI Settings Modal -->
	<div class="modal-overlay" id="aiSettingsModal">
		<div class="modal settings-modal">
			<div class="modal-header">
				<h2><i class="ri-robot-2-line"></i> AI 押韵设置</h2>
				<button class="modal-close" id="closeAiSettings"><i class="ri-close-line"></i></button>
			</div>
			<div class="settings-body">
				<div class="settings-item">
					<label for="geminiApiKey">
						<span>Gemini API Key</span>
						<span class="badge-mini">必填</span>
					</label>
					<div class="input-wrapper">
						<i class="ri-key-2-line input-icon"></i>
						<input type="password" id="geminiApiKey" placeholder="输入您的 API Key" />
					</div>
					<p class="field-hint">需要 Google Gemini API Key 才能使用 AI 功能。</p>
				</div>

				<div class="settings-item">
					<label for="geminiModel">选择模型</label>
					<div class="select-wrapper">
						<i class="ri-cpu-line input-icon"></i>
						<select id="geminiModel">
							<option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
							<option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
							<option value="gemini-3-flash-preview">Gemini 3.0 Flash</option>
							<option value="gemini-3-pro-preview">Gemini 3.0 Pro</option>
						</select>
						<i class="ri-arrow-down-s-line select-arrow"></i>
					</div>
				</div>

				<div class="settings-item">
					<label for="geminiProxy">API 代理地址</label>
					<div class="input-wrapper">
						<i class="ri-global-line input-icon"></i>
						<input type="text" id="geminiProxy" placeholder="例如: http://127.0.0.1:7890" />
					</div>
					<p class="field-hint">如果无法直接访问 Google API，请配置代理地址。</p>
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn" style="width: 100%;" id="saveAiSettings">保存设置</button>
			</div>
		</div>
	</div>

	<!-- Help Modal -->
	<button class="help-btn" id="helpTriggerBtn" title="使用说明">?</button>
	<div class="modal-overlay" id="helpModalOverlay">
		<div class="modal">
			<div class="modal-header">
				<h2>使用说明</h2>
				<button class="modal-close" id="helpCloseBtn">&times;</button>
			</div>
						<div class="modal-content">
				<h3> 基本功能</h3>
				<ul>
					<li><strong>加载词库：</strong>使用前请务必点击<strong>「加载词库」</strong>按钮</li>
					<li><strong>输入文字：</strong>在左侧输入框输入需要押韵的词语</li>
					<li><strong>生成押韵：</strong>点击<strong>「生成押韵」</strong>按钮，系统会自动分析并生成押韵词汇</li>
					<li><strong>韵脚宽松度：</strong>调节滑块可以放宽押韵条件，最宽松时可以选择显示平仄</li>
				</ul>
				
				<h3> 高级设置</h3>
				<ul>
					<li><strong>AI 押韵模式：</strong>启用后需要自行填入 Gemini API Key</li>
					<li><strong>支持的模型：</strong>目前 AI 模式暂时只支持 Gemini</li>
				</ul>
				
				<h3> 使用技巧</h3>
				<ul>
					<li>建议先从较严格的韵脚开始尝试，再逐步放宽条件</li>
					<li>可以多尝试不同的输入词语，探索更多押韵可能性</li>
					<li>AI 模式可以生成更有创意的押韵词汇，但需要联网使用</li>
				</ul>
				
				<h3>ℹ 关于</h3>
				<p>这是一个简单的中文押韵生成器，旨在帮助创作者寻找灵感。</p>
				<p style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); text-align: center;">
					爷不肉，蛋卷制造 2026
				</p>
			</div>
		</div>
	</div>






























	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>
	<script src="https://cdn.jsdelivr.net/npm/@formkit/auto-animate@0.8.2/index.min.js" defer></script>
	<script src="data.js" defer></script>
	<script src="scripts/db.js" defer></script>
	<script src="scripts/rhyme-engine.js" defer></script>
	<script src="scripts/dict-manager.js" defer></script>
	<script src="scripts/app.js" defer></script>
	
	<script>
		// GSAP Animations
		window.addEventListener("load", () => {
			console.time('gsap-init-and-run');
			if (typeof gsap === 'undefined') return;
			
			// Register ScrollTrigger plugin
			gsap.registerPlugin(ScrollTrigger);
			
			gsap.to(".blob-1", { x: "20%", y: "20%", duration: 8, repeat: -1, yoyo: true, ease: "sine.inOut" });
			gsap.to(".blob-2", { x: "-20%", y: "-20%", duration: 10, repeat: -1, yoyo: true, ease: "sine.inOut", delay: 1 });
			gsap.to(".blob-3", { x: "15%", y: "-15%", scale: 1.2, duration: 12, repeat: -1, yoyo: true, ease: "sine.inOut", delay: 2 });

			// 统一设置 visibility，避免 FOUC
			gsap.set(".shell, .panel", { visibility: "visible" });

			gsap.from(".shell", { y: 30, opacity: 0, duration: 1 });
			console.timeEnd('gsap-init-and-run');

			// AutoAnimate integration
			if (typeof autoAnimate !== 'undefined') {
				const outputContainer = document.getElementById('output');
				const badgesContainer = document.getElementById('badges');
				const matchedList = document.getElementById('matchedResultsList');
				
				autoAnimate(outputContainer);
				autoAnimate(badgesContainer);
				autoAnimate(matchedList);
			}

			// Apply ScrollTrigger to panels
			gsap.utils.toArray(".panel").forEach((panel, i) => {
				gsap.from(panel, {
					scrollTrigger: {
						trigger: panel,
						start: "top 90%", // 当面板顶部到达视口 90% 位置时开始
						toggleActions: "play none none none"
					},
					y: 50,
					opacity: 0,
					duration: 0.8,
					delay: i * 0.1,
					ease: "power2.out"
				});
			});
			
			window.triggerResultAnimation = () => {
				gsap.fromTo("#output", { opacity: 0.5, y: 5 }, { opacity: 1, y: 0, duration: 0.4 });
			};

			// Help Modal Logic
			const helpBtn = document.getElementById('helpTriggerBtn');
			const helpModal = document.getElementById('helpModalOverlay');
			const helpClose = document.getElementById('helpCloseBtn');
			
			helpBtn.onclick = () => helpModal.classList.add('active');
			helpClose.onclick = () => helpModal.classList.remove('active');
			
			// Close Settings Modal
			document.getElementById('closeAiSettings').onclick = () => {
				document.getElementById('aiSettingsModal').classList.remove('active');
			};
		});
	</script>
</body>
</html>
